
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spatial joins &#8212; HealthGIS with Python</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="../_static/logo.jpeg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/logo.jpeg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">HealthGIS with Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/04-spatial-joins.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/hossainlab/health-gis/"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/hossainlab/health-gis/master?urlpath=tree/book/notebooks/04-spatial-joins.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/hossainlab/health-gis/blob/master/book/notebooks/04-spatial-joins.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#recap-joining-dataframes">
   Recap - joining dataframes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#recap-spatial-relationships-between-objects">
   Recap - spatial relationships between objects
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#spatial-join-operation">
   Spatial join operation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lets-s-practice">
   Lets’s practice!
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-overlay-operation">
   The overlay operation
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="spatial-joins">
<h1>Spatial joins<a class="headerlink" href="#spatial-joins" title="Permalink to this headline">¶</a></h1>
<p>Goals of this notebook:</p>
<ul class="simple">
<li><p>Based on the <code class="docutils literal notranslate"><span class="pre">countries</span></code> and <code class="docutils literal notranslate"><span class="pre">cities</span></code> dataframes, determine for each city the country in which it is located.</p></li>
<li><p>To solve this problem, we will use the the concept of a ‘spatial join’ operation: combining information of geospatial datasets based on their spatial relationship.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">countries</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;zip://./data/ne_110m_admin_0_countries.zip&quot;</span><span class="p">)</span>
<span class="n">cities</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;zip://./data/ne_110m_populated_places.zip&quot;</span><span class="p">)</span>
<span class="n">rivers</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;zip://./data/ne_50m_rivers_lake_centerlines.zip&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="recap-joining-dataframes">
<h2>Recap - joining dataframes<a class="headerlink" href="#recap-joining-dataframes" title="Permalink to this headline">¶</a></h2>
<p>Pandas provides functionality to join or merge dataframes in different ways, see <a class="reference external" href="https://chrisalbon.com/python/data_wrangling/pandas_join_merge_dataframe/">https://chrisalbon.com/python/data_wrangling/pandas_join_merge_dataframe/</a> for an overview and <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/merging.html">https://pandas.pydata.org/pandas-docs/stable/merging.html</a> for the full documentation.</p>
<p>To illustrate the concept of joining the information of two dataframes with pandas, let’s take a small subset of our <code class="docutils literal notranslate"><span class="pre">cities</span></code> and <code class="docutils literal notranslate"><span class="pre">countries</span></code> datasets:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities2</span> <span class="o">=</span> <span class="n">cities</span><span class="p">[</span><span class="n">cities</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;Bern&#39;</span><span class="p">,</span> <span class="s1">&#39;Brussels&#39;</span><span class="p">,</span> <span class="s1">&#39;London&#39;</span><span class="p">,</span> <span class="s1">&#39;Paris&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">cities2</span><span class="p">[</span><span class="s1">&#39;iso_a3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CHE&#39;</span><span class="p">,</span> <span class="s1">&#39;BEL&#39;</span><span class="p">,</span> <span class="s1">&#39;GBR&#39;</span><span class="p">,</span> <span class="s1">&#39;FRA&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">countries2</span> <span class="o">=</span> <span class="n">countries</span><span class="p">[[</span><span class="s1">&#39;iso_a3&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;continent&#39;</span><span class="p">]]</span>
<span class="n">countries2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We added a ‘iso_a3’ column to the <code class="docutils literal notranslate"><span class="pre">cities</span></code> dataset, indicating a code of the country of the city. This country code is also present in the <code class="docutils literal notranslate"><span class="pre">countries</span></code> dataset, which allows us to merge those two dataframes based on the common column.</p>
<p>Joining the <code class="docutils literal notranslate"><span class="pre">cities</span></code> dataframe with <code class="docutils literal notranslate"><span class="pre">countries</span></code> will transfer extra information about the countries (the full name, the continent) to the <code class="docutils literal notranslate"><span class="pre">cities</span></code> dataframe, based on a common key:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities2</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">countries2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;iso_a3&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>But</strong>, for this illustrative example, we added the common column manually, it is not present in the original dataset. However, we can still know how to join those two datasets based on their spatial coordinates.</p>
</div>
<div class="section" id="recap-spatial-relationships-between-objects">
<h2>Recap - spatial relationships between objects<a class="headerlink" href="#recap-spatial-relationships-between-objects" title="Permalink to this headline">¶</a></h2>
<p>In the previous notebook <span class="xref myst">02-spatial-relationships.ipynb</span>, we have seen the notion of spatial relationships between geometry objects: within, contains, intersects, …</p>
<p>In this case, we know that each of the cities is located <em>within</em> one of the countries, or the other way around that each country can <em>contain</em> multiple cities.</p>
<p>We can test such relationships using the methods we have seen in the previous notebook:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">france</span> <span class="o">=</span> <span class="n">countries</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">countries</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;France&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities</span><span class="o">.</span><span class="n">within</span><span class="p">(</span><span class="n">france</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The above gives us a boolean series, indicating for each point in our <code class="docutils literal notranslate"><span class="pre">cities</span></code> dataframe whether it is located within the area of France or not.<br />
Because this is a boolean series as result, we can use it to filter the original dataframe to only show those cities that are actually within France:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities</span><span class="p">[</span><span class="n">cities</span><span class="o">.</span><span class="n">within</span><span class="p">(</span><span class="n">france</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>We could now repeat the above analysis for each of the countries, and add a column to the <code class="docutils literal notranslate"><span class="pre">cities</span></code> dataframe indicating this country. However, that would be tedious to do manually, and is also exactly what the spatial join operation provides us.</p>
<p><em>(note: the above result is incorrect, but this is just because of the coarse-ness of the countries dataset)</em></p>
</div>
<div class="section" id="spatial-join-operation">
<h2>Spatial join operation<a class="headerlink" href="#spatial-join-operation" title="Permalink to this headline">¶</a></h2>
<div class="alert alert-info" style="font-size:120%">
<p><strong>SPATIAL JOIN</strong> = <em>transferring attributes from one layer to another based on their spatial relationship</em> <br></p>
<p>Different parts of this operations:</p>
<ul class="simple">
<li><p>The GeoDataFrame to which we want add information</p></li>
<li><p>The GeoDataFrame that contains the information we want to add</p></li>
<li><p>The spatial relationship we want to use to match both datasets (‘intersects’, ‘contains’, ‘within’)</p></li>
<li><p>The type of join: left or inner join</p></li>
</ul>
<p><img alt="" src="notebooks/img/illustration-spatial-join.svg" /></p>
</div><p>In this case, we want to join the <code class="docutils literal notranslate"><span class="pre">cities</span></code> dataframe with the information of the <code class="docutils literal notranslate"><span class="pre">countries</span></code> dataframe, based on the spatial relationship between both datasets.</p>
<p>We use the <a class="reference external" href="http://geopandas.readthedocs.io/en/latest/reference/geopandas.sjoin.html"><code class="docutils literal notranslate"><span class="pre">geopandas.sjoin</span></code></a> function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">joined</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span><span class="n">cities</span><span class="p">,</span> <span class="n">countries</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="s1">&#39;within&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">joined</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">joined</span><span class="p">[</span><span class="s1">&#39;continent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="lets-s-practice">
<h2>Lets’s practice!<a class="headerlink" href="#lets-s-practice" title="Permalink to this headline">¶</a></h2>
<p>We will again use the Paris datasets to do some exercises. Let’s start importing them again:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">districts</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;data/paris_districts.geojson&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">2154</span><span class="p">)</span>
<span class="n">stations</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;data/paris_bike_stations.geojson&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">2154</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="alert alert-success">
<p><strong>EXERCISE:</strong></p>
<ul class="simple">
<li><p>Determine for each bike station in which district it is located (using a spatial join!). Call the result <code class="docutils literal notranslate"><span class="pre">joined</span></code>.</p></li>
</ul>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins1.py</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins2.py</span>
</pre></div>
</div>
</div>
</div>
<div class="alert alert-success">
<p><strong>EXERCISE: Map of tree density by district (I)</strong></p>
<p>Using a dataset of all trees in public spaces in Paris, the goal is to make a map of the tree density by district. For this, we first need to find out how many trees each district contains, which we will do in this exercise. In the following exercise, we will then use this result to calculate the density and create a map.</p>
<p>To obtain the tree count by district, we first need to know in which district each tree is located, which we can do with a spatial join. Then, using the result of the spatial join, we will calculate the number of trees located in each district using the pandas ‘group-by’ functionality.</p>
<ul class="simple">
<li><p>Import the trees dataset <code class="docutils literal notranslate"><span class="pre">&quot;paris_trees.gpkg&quot;</span></code> and call the result <code class="docutils literal notranslate"><span class="pre">trees</span></code>. Also read the districts dataset we have seen previously (<code class="docutils literal notranslate"><span class="pre">&quot;paris_districts.geojson&quot;</span></code>), and call this <code class="docutils literal notranslate"><span class="pre">districts</span></code>. Convert the districts dataset to the same CRS as the trees dataset.</p></li>
<li><p>Add a column with the <code class="docutils literal notranslate"><span class="pre">'district_name'</span></code> to the trees dataset using a spatial join. Call the result <code class="docutils literal notranslate"><span class="pre">joined</span></code>.</p></li>
</ul>
<details><summary>Hints</summary>
<ul class="simple">
<li><p>Remember, we can perform a spatial join with the <code class="docutils literal notranslate"><span class="pre">geopandas.sjoin()</span></code> function.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geopandas.sjoin()</span></code> takes as first argument the dataframe to which we want to add information, and as second argument the dataframe that contains this additional information.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">op</span></code> argument is used to specify which spatial relationship between both dataframes we want to use for joining (options are <code class="docutils literal notranslate"><span class="pre">'intersects'</span></code>, <code class="docutils literal notranslate"><span class="pre">'contains'</span></code>, <code class="docutils literal notranslate"><span class="pre">'within'</span></code>).</p></li>
</ul>
</details>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins3.py</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins4.py</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins5.py</span>
</pre></div>
</div>
</div>
</div>
<div class="alert alert-success">
<p><strong>EXERCISE: Map of tree density by district (II)</strong></p>
<ul class="simple">
<li><p>Calculate the number of trees located in each district: group the <code class="docutils literal notranslate"><span class="pre">joined</span></code> DataFrame by the <code class="docutils literal notranslate"><span class="pre">'district_name'</span></code> column, and calculate the size of each group. We convert the resulting Series <code class="docutils literal notranslate"><span class="pre">trees_by_district</span></code> to a DataFrame for the next exercise.</p></li>
</ul>
<details><summary>Hints</summary>
<ul class="simple">
<li><p>The general group-by syntax in pandas is: <code class="docutils literal notranslate"><span class="pre">df.groupby('key').aggregation_method()</span></code>, substituting ‘key’ and ‘aggregation_method’ with the appropriate column name and method.</p></li>
<li><p>To know the size of groups, we can use the <code class="docutils literal notranslate"><span class="pre">.size()</span></code> method.</p></li>
</ul>
</details>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins6.py</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins7.py</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins8.py</span>
</pre></div>
</div>
</div>
</div>
<div class="alert alert-success">
<p><strong>EXERCISE: Map of tree density by district (III)</strong></p>
<p>Now we have obtained the number of trees by district, we can make the map of the districts colored by the tree density.</p>
<p>For this, we first need to merge the number of trees in each district we calculated in the previous step (<code class="docutils literal notranslate"><span class="pre">trees_by_district</span></code>) back to the districts dataset. We will use the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.merge.html"><code class="docutils literal notranslate"><span class="pre">pd.merge()</span></code></a> function to join two dataframes based on a common column.</p>
<p>Since not all districts have the same size, it is a fairer comparison to visualize the tree density: the number of trees relative to the area.</p>
<ul class="simple">
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">pd.merge()</span></code> function to merge <code class="docutils literal notranslate"><span class="pre">districts</span></code> and <code class="docutils literal notranslate"><span class="pre">trees_by_district</span></code> dataframes on the <code class="docutils literal notranslate"><span class="pre">'district_name'</span></code> column. Call the result <code class="docutils literal notranslate"><span class="pre">districts_trees</span></code>.</p></li>
<li><p>Add a column <code class="docutils literal notranslate"><span class="pre">'n_trees_per_area'</span></code> to the <code class="docutils literal notranslate"><span class="pre">districts_trees</span></code> dataframe, based on the <code class="docutils literal notranslate"><span class="pre">'n_trees'</span></code> column divided by the area.</p></li>
<li><p>Make a plot of the <code class="docutils literal notranslate"><span class="pre">districts_trees</span></code> dataframe, using the <code class="docutils literal notranslate"><span class="pre">'n_trees_per_area'</span></code> column to determine the color of the polygons.</p></li>
</ul>
<details><summary>Hints</summary>
<ul class="simple">
<li><p>The pandas <code class="docutils literal notranslate"><span class="pre">pd.merge()</span></code> function takes the two dataframes you want to merge as the first two arguments.</p></li>
<li><p>The column name on which you want to merge both datasets can be specified with the <code class="docutils literal notranslate"><span class="pre">on</span></code> keyword.</p></li>
<li><p>Accessing a column of a DataFrame can be done with <code class="docutils literal notranslate"><span class="pre">df['col']</span></code>, while adding a column to a DataFrame can be done with <code class="docutils literal notranslate"><span class="pre">df['new_col']</span> <span class="pre">=</span> <span class="pre">values</span></code> where <code class="docutils literal notranslate"><span class="pre">values</span></code> can be the result of a computation.</p></li>
<li><p>Remember, the area of each geometry in a GeoSeries or GeoDataFrame can be retrieved using the <code class="docutils literal notranslate"><span class="pre">area</span></code> attribute. So considering a GeoDataFrame <code class="docutils literal notranslate"><span class="pre">gdf</span></code>, then <code class="docutils literal notranslate"><span class="pre">gdf.geometry.area</span></code> will return a Series with the area of each geometry.</p></li>
<li><p>We can use the <code class="docutils literal notranslate"><span class="pre">.plot()</span></code> method of a GeoDataFrame to make a visualization of the geometries.</p></li>
<li><p>For using one of the columns of the GeoDataFrame to determine the fill color, use the <code class="docutils literal notranslate"><span class="pre">column=</span></code> keyword.</p></li>
</ul>
</details>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins9.py</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins10.py</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins11.py</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="the-overlay-operation">
<h2>The overlay operation<a class="headerlink" href="#the-overlay-operation" title="Permalink to this headline">¶</a></h2>
<p>In the spatial join operation above, we are not changing the geometries itself. We are not joining geometries, but joining attributes based on a spatial relationship between the geometries. This also means that the geometries need to at least overlap partially.</p>
<p>If you want to create new geometries based on joining (combining) geometries of different dataframes into one new dataframe (eg by taking the intersection of the geometries), you want an <strong>overlay</strong> operation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">africa</span> <span class="o">=</span> <span class="n">countries</span><span class="p">[</span><span class="n">countries</span><span class="p">[</span><span class="s1">&#39;continent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Africa&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">africa</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cities</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geopandas</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">africa</span><span class="p">,</span> <span class="n">cities</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;difference&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="alert alert-info" style="font-size:120%">
<b>REMEMBER</b> <br>
<ul class="simple">
<li><p><strong>Spatial join</strong>: transfer attributes from one dataframe to another based on the spatial relationship</p></li>
<li><p><strong>Spatial overlay</strong>: construct new geometries based on spatial operation between both dataframes (and combining attributes of both dataframes)</p></li>
</ul>
</div><div class="alert alert-success">
<p><strong>EXERCISE: Exploring a Land Use dataset</strong></p>
<p>For the following exercises, we first introduce a new dataset: a dataset about the land use of Paris (a simplified version based on the open European <a class="reference external" href="https://land.copernicus.eu/local/urban-atlas">Urban Atlas</a>). The land use indicates for what kind of activity a certain area is used, such as residential area or for recreation. It is a polygon dataset, with a label representing the land use class for different areas in Paris.</p>
<p>In this exercise, we will read the data, explore it visually, and calculate the total area of the different classes of land use in the area of Paris.</p>
<ul class="simple">
<li><p>Read in the <code class="docutils literal notranslate"><span class="pre">'paris_land_use.shp'</span></code> file and assign the result to a variable <code class="docutils literal notranslate"><span class="pre">land_use</span></code>.</p></li>
<li><p>Make a plot of <code class="docutils literal notranslate"><span class="pre">land_use</span></code>, using the <code class="docutils literal notranslate"><span class="pre">'class'</span></code> column to color the polygons. We also add a legend. Note: it might take a few seconds for the plot to generate because there are a lot of polygons.</p></li>
<li><p>Add a new column <code class="docutils literal notranslate"><span class="pre">'area'</span></code> with the area of each polygon.</p></li>
<li><p>Calculate the total area in km² for each <code class="docutils literal notranslate"><span class="pre">'class'</span></code> using the <code class="docutils literal notranslate"><span class="pre">groupby()</span></code> method, and print the result.</p></li>
</ul>
<details><summary>Hints</summary>
<ul class="simple">
<li><p>Reading a file can be done with the <code class="docutils literal notranslate"><span class="pre">geopandas.read_file()</span></code> function.</p></li>
<li><p>To use a column to color the geometries, use the <code class="docutils literal notranslate"><span class="pre">column</span></code> keyword to indicate the column name.</p></li>
<li><p>The area of each geometry can be accessed with the <code class="docutils literal notranslate"><span class="pre">area</span></code> attribute of the <code class="docutils literal notranslate"><span class="pre">geometry</span></code> of the GeoDataFrame.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">groupby()</span></code> method takes the column name on which you want to group as the first argument.</p></li>
</ul>
</details>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins12.py</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins13.py</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins14.py</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins15.py</span>
</pre></div>
</div>
</div>
</div>
<div class="alert alert-success">
<p><strong>EXERCISE: Intersection of two polygons</strong></p>
<p>For this exercise, we are going to use 2 individual polygons: the district of Muette extracted from the <code class="docutils literal notranslate"><span class="pre">districts</span></code> dataset, and the green urban area of Boulogne, a large public park in the west of Paris, extracted from the <code class="docutils literal notranslate"><span class="pre">land_use</span></code> dataset. The two polygons have already been assigned to the <code class="docutils literal notranslate"><span class="pre">muette</span></code> and <code class="docutils literal notranslate"><span class="pre">park_boulogne</span></code> variables.</p>
<p>We first visualize the two polygons. You will see that they overlap, but the park is not fully located in the district of Muette. Let’s determine the overlapping part.</p>
<ul class="simple">
<li><p>Plot the two polygons in a single map to examine visually the degree of overlap</p></li>
<li><p>Calculate the intersection of the <code class="docutils literal notranslate"><span class="pre">park_boulogne</span></code> and <code class="docutils literal notranslate"><span class="pre">muette</span></code> polygons.</p></li>
<li><p>Print the proportion of the area of the district that is occupied by the park.</p></li>
</ul>
<details><summary>Hints</summary>
<ul class="simple">
<li><p>The intersection of to scalar polygons can be calculated with the <code class="docutils literal notranslate"><span class="pre">intersection()</span></code> method of one of the polygons, and passing the other polygon as the argument to that method.</p></li>
</ul>
</details>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">land_use</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;zip://./data/paris_land_use.zip&quot;</span><span class="p">)</span>
<span class="n">districts</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;data/paris_districts.geojson&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">land_use</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># extract polygons</span>
<span class="n">land_use</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">land_use</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">area</span>
<span class="n">park_boulogne</span> <span class="o">=</span> <span class="n">land_use</span><span class="p">[</span><span class="n">land_use</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Green urban areas&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;area&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">muette</span> <span class="o">=</span> <span class="n">districts</span><span class="p">[</span><span class="n">districts</span><span class="o">.</span><span class="n">district_name</span> <span class="o">==</span> <span class="s1">&#39;Muette&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the two polygons</span>
<span class="n">geopandas</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">([</span><span class="n">park_boulogne</span><span class="p">,</span> <span class="n">muette</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins16.py</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins17.py</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins18.py</span>
</pre></div>
</div>
</div>
</div>
<div class="alert alert-success">
<p><strong>EXERCISE: Intersecting a GeoDataFrame with a Polygon</strong></p>
<p>Combining the land use dataset and the districts dataset, we can now investigate what the land use is in a certain district.</p>
<p>For that, we first need to determine the intersection of the land use dataset with a given district. Let’s take again the <em>Muette</em> district as example case.</p>
<ul class="simple">
<li><p>Calculate the intersection of the <code class="docutils literal notranslate"><span class="pre">land_use</span></code> polygons with the single <code class="docutils literal notranslate"><span class="pre">muette</span></code> polygon. Call the result <code class="docutils literal notranslate"><span class="pre">land_use_muette</span></code>.</p></li>
<li><p>Make a quick plot of this intersection, and pass <code class="docutils literal notranslate"><span class="pre">edgecolor='black'</span></code> to more clearly see the boundaries of the different polygons.</p></li>
<li><p>Print the first five rows of <code class="docutils literal notranslate"><span class="pre">land_use_muette</span></code>.</p></li>
</ul>
<details><summary>Hints</summary>
<ul class="simple">
<li><p>The intersection of each geometry of a GeoSeries with another single geometry can be performed with the <code class="docutils literal notranslate"><span class="pre">intersection()</span></code> method of a GeoSeries.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">intersection()</span></code> method takes as argument the geometry for which to calculate the intersection.</p></li>
</ul>
</details>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">land_use</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;zip://./data/paris_land_use.zip&quot;</span><span class="p">)</span>
<span class="n">districts</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;data/paris_districts.geojson&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">land_use</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
<span class="n">muette</span> <span class="o">=</span> <span class="n">districts</span><span class="p">[</span><span class="n">districts</span><span class="o">.</span><span class="n">district_name</span> <span class="o">==</span> <span class="s1">&#39;Muette&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins19.py</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins20.py</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print the first five rows of the intersection</span>
<span class="n">land_use_muette</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>You can see in the plot that we now only have a subset of the full land use dataset. The <code class="docutils literal notranslate"><span class="pre">land_use_muette</span></code> still has the same number of rows as the original <code class="docutils literal notranslate"><span class="pre">land_use</span></code>, though. But many of the rows, as you could see by printing the first rows, consist now of empty polygons when it did not intersect with the Muette district.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">land_use_muette</span> <span class="o">=</span> <span class="n">land_use</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">land_use_muette</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">land_use</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">muette</span><span class="p">)</span>
<span class="n">land_use_muette</span> <span class="o">=</span> <span class="n">land_use_muette</span><span class="p">[</span><span class="o">~</span><span class="n">land_use_muette</span><span class="o">.</span><span class="n">is_empty</span><span class="p">]</span>
<span class="n">land_use_muette</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">land_use_muette</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;class&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">land_use_muette</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;class&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;class&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="alert alert-success">
<p><strong>EXERCISE: Overlaying spatial datasets</strong></p>
<p>We will now combine both datasets in an overlay operation. Create a new <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code> consisting of the intersection of the land use polygons wich each of the districts, but make sure to bring the attribute data from both source layers.</p>
<p>Once we created the overlay of the land use and districts datasets, we can more easily inspect the land use for the different districts. Let’s get back to the example district of Muette, and inspect the land use of that district.</p>
<ul class="simple">
<li><p>Create a new GeoDataFrame from the intersections of <code class="docutils literal notranslate"><span class="pre">land_use</span></code> and <code class="docutils literal notranslate"><span class="pre">districts</span></code>. Assign the result to a variable <code class="docutils literal notranslate"><span class="pre">combined</span></code>.</p></li>
<li><p>Print the first rows the resulting GeoDataFrame (<code class="docutils literal notranslate"><span class="pre">combined</span></code>).</p></li>
<li><p>Add a new column <code class="docutils literal notranslate"><span class="pre">'area'</span></code> with the area of each polygon to the <code class="docutils literal notranslate"><span class="pre">combined</span></code> GeoDataFrame.</p></li>
<li><p>Create a subset called <code class="docutils literal notranslate"><span class="pre">land_use_muette</span></code> where the <code class="docutils literal notranslate"><span class="pre">'district_name'</span></code> is equal to “Muette”.</p></li>
<li><p>Make a plot of <code class="docutils literal notranslate"><span class="pre">land_use_muette</span></code>, using the <code class="docutils literal notranslate"><span class="pre">'class'</span></code> column to color the polygons.</p></li>
<li><p>Calculate the total area for each <code class="docutils literal notranslate"><span class="pre">'class'</span></code> of <code class="docutils literal notranslate"><span class="pre">land_use_muette</span></code> using the <code class="docutils literal notranslate"><span class="pre">groupby()</span></code> method, and print the result.</p></li>
</ul>
<details><summary>Hints</summary>
<ul class="simple">
<li><p>The intersection of two GeoDataFrames can be calculated with the <code class="docutils literal notranslate"><span class="pre">geopandas.overlay()</span></code> function.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">overlay()</span></code> functions takes first the two GeoDataFrames to combine, and a third <code class="docutils literal notranslate"><span class="pre">how</span></code> keyword indicating how to combine the two layers.</p></li>
<li><p>For making an overlay based on the intersection, you can pass <code class="docutils literal notranslate"><span class="pre">how='intersection'</span></code>.</p></li>
<li><p>The area of each geometry can be accessed with the <code class="docutils literal notranslate"><span class="pre">area</span></code> attribute of the <code class="docutils literal notranslate"><span class="pre">geometry</span></code> of the GeoDataFrame.</p></li>
<li><p>To use a column to color the geometries, pass its name to the <code class="docutils literal notranslate"><span class="pre">column</span></code> keyword.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">groupby()</span></code> method takes the column name on which you want to group as the first argument.</p></li>
<li><p>The total area for each class can be calculated by taking the <code class="docutils literal notranslate"><span class="pre">sum()</span></code> of the area.</p></li>
</ul>
</details>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">land_use</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;zip://./data/paris_land_use.zip&quot;</span><span class="p">)</span>
<span class="n">districts</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;data/paris_districts.geojson&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">land_use</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins21.py</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins22.py</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins23.py</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins24.py</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins25.py</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load _solved/solutions/04-spatial-joins26.py</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "hossainlab/health-gis",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Jubayer Hossain<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>